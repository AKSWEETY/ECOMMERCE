<script>

function send_friend_request(user_id){
    let url = "/send_friend_request?user_id="+user_id
    $.get(url, function(data, status){
        console.log(data)
        get_users();
    });
}
function cancel_request_from_user(user_id){
    let url = "/cancel_request_from_user?user_id="+user_id
    $.get(url, function(data, status){
        console.log(data)
        get_users();
    });
}
function accept_request(user_id){
    let url = "/accept_request?user_id="+user_id
    $.get(url, function(data, status){
        console.log(data)
        get_users();
    });
}
function reject_request(user_id){
    let url =  "/reject_request?user_id="+user_id
    $.get(url, function(data, status){
        console.log(data)
        get_users();
    });
}
function un_friend(user_id){
    let url = "/un_friend?user_id="+user_id
    $.get(url, function(data, status){
        console.log(data)
        get_users();
    });
}
function block(user_id){
    let url = "/block?user_id="+user_id
    $.get(url, function(data, status){
        console.log(data)
        get_users();
    });
}
function un_block(user_id){
    let url = "/un_block?user_id="+user_id
    $.get(url, function(data, status){
        console.log(data)
        get_users();
    });
}

</script>
<div class="row2">
    {% for user in users %}
    {% set friend_request = get_request_status_by_user_id(user[0]) %}
    <div class="card w-20 p-20 mt-20 ml-45">
        <div class=" ">
            <div class="">
                <div><img src="../static/E_commerce_files/{{user[7]}}" class="w-100" style="max-width:100%; height:200px; border-radius:14px;"></div>
               <div class="flex mt-10">
                   <div class="">
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="pink" class="bi bi-person-fill" viewBox="0 0 16 16">
                          <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                        </svg>
                   </div>
                   <div class="ml-10">{{user[1]}}</div>
               </div>
                <div class="flex mt-10">
                   <div>
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="pink" class="bi bi-envelope" viewBox="0 0 16 16">
                          <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/>
                        </svg>
                   </div>
                   <div class="ml-10">{{user[2]}}</div>
               </div>
                <div class="flex mt-10">
                   <div>
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="pink" class="bi bi-telephone-fill" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z"/>
                        </svg>
                   </div>
                   <div class="ml-10">{{user[3]}}</div>
               </div>
               <div class="flex mt-10">
                   <div>
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="pink" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                          <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                       </svg>
                   </div>
                   <div class="ml-10">{{user[5]}}</div>
               </div>
                <div class="flex mt-10">
                   <div>
                       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="pink" class="bi bi-check-circle" viewBox="0 0 16 16">
                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                          <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
                       </svg>
                   </div>
                   <div class="ml-10">{{friend_request[1]}}</div>
               </div>
            </div>
        </div>

        {% if friend_request == None  %}
             <button  class="form-btn mt-10" onclick="send_friend_request('{{user[0]}}')">Send Friend Request</button>
        {% elif friend_request[1]=="Requested" %}
              {% if friend_request[3] == session['user_id']  %}
                <button  class="form-btn mt-10" onclick="cancel_request_from_user('{{user[0]}}')">Cancel Request</button>
              {% elif friend_request[4]== session['user_id'] %}
                <button  class="form-btn mt-10" onclick="accept_request('{{user[0]}}')">Accept Request</button>
                <button  class="form-btn" onclick="reject_request('{{user[0]}}')">Reject Request</button>
              {% endif %}
        {% elif friend_request[1]=="Accepted" %}
             <button  class="form-btn mt-10" onclick="un_friend('{{user[0]}}')">Unfriend</button>
             <button  class="form-btn" onclick="block('{{user[0]}}')">Block</button>
        {% elif friend_request[1]=="Blocked" %}
             <button  class="form-btn mt-5" onclick="un_block('{{user[0]}}')">UnBlock</button>
        {% elif friend_request[1]=="UnFriend" %}
             <button  class="form-btn mt-40" onclick="accept_request('{{user[0]}}')">Friends</button>
        {% elif friend_request[1]=="UnBlock" %}
             <button  class="form-btn mt-40" onclick="accept_request('{{user[0]}}')">Friends</button>
        {% endif %}
    </div>
    {% endfor %}
</div>